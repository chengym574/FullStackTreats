<%= render 'shared/navbar' %>
<h1>Order Confirmation</h1>

<h2>Shipping Address</h2>
<%= form_for current_user.location || Location.new, url: address_checkout_path, method: :patch, data: {turbo: false} do |f| %>
  <div>
    <%= f.label :address, 'Address' %>
    <%= f.text_field :address, value: current_user.location&.address, placeholder: 'Enter Address' %>
  </div>
  <div>
    <%= f.label :city, 'City' %>
    <%= f.text_field :city, value: current_user.location&.city, placeholder: 'Enter City' %>
  </div>
  <div>
    <%= f.label :province, 'Province' %>
    <%= f.text_field :province, value: current_user.location&.province, placeholder: 'Enter Province' %>
  </div>
  <%= f.submit 'Save Address' %>
<% end %>

<h2>Order Details</h2>
<% if @cart_items.any? %>
  <table>
    <thead>
      <tr>
        <th>Product</th>
        <th>Quantity</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody>
      <% @cart_items.each do |item| %>
        <tr>
          <td><%= item[:product].name %></td>
          <td><%= item[:quantity] %></td>
          <td>$ <%= item[:product].price %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div>
    <p>Subtotal: $ <%= number_to_currency(@subtotal) %></p>
    <p>GST: $ <%= number_to_currency(@gst) %></p>
    <p>PST: $ <%= number_to_currency(@pst) %></p>
    <p>HST: $ <%= number_to_currency(@hst) %></p>
    <p><strong>Total: $ <%= number_to_currency(@total) %></strong></p>

    <%= link_to "Confirm Order", confirm_order_checkout_path %>
  </div>
  <% if flash[:alert] %>
    <%= flash[:alert] %>
  <% end %>
<% else %>
  <p>Your cart is empty.</p>
<% end %>